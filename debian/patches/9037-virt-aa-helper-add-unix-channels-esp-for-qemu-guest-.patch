From f02696388ec31bb17fc8a3c96d8d79efd15b39af Mon Sep 17 00:00:00 2001
From: Serge Hallyn <serge.hallyn@ubuntu.com>
Date: Mon, 6 Apr 2015 11:08:31 -0500
Subject: [PATCH 1/1] virt-aa-helper: add unix channels (esp for
 qemu-guest-agent)

Signed-off-by: Serge Hallyn <serge.hallyn@ubuntu.com>
---
 src/security/virt-aa-helper.c | 1 +
 1 file changed, 1 insertion(+)

Index: libvirt-1.2.12/src/security/virt-aa-helper.c
===================================================================
--- libvirt-1.2.12.orig/src/security/virt-aa-helper.c
+++ libvirt-1.2.12/src/security/virt-aa-helper.c
@@ -998,8 +998,10 @@ get_files(vahControl * ctl)
             (ctl->def->channels[i]->source.type == VIR_DOMAIN_CHR_TYPE_PTY ||
              ctl->def->channels[i]->source.type == VIR_DOMAIN_CHR_TYPE_DEV ||
              ctl->def->channels[i]->source.type == VIR_DOMAIN_CHR_TYPE_FILE ||
+             ctl->def->channels[i]->source.type == VIR_DOMAIN_CHR_TYPE_UNIX ||
              ctl->def->channels[i]->source.type == VIR_DOMAIN_CHR_TYPE_PIPE) &&
-            ctl->def->channels[i]->source.data.file.path)
+             ctl->def->channels[i]->source.data.file.path &&
+             *ctl->def->channels[i]->source.data.file.path != '\0')
             if (vah_add_file_chardev(&buf,
                                      ctl->def->channels[i]->source.data.file.path,
                                      "rw",
