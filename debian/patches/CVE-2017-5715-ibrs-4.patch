Backport of:

From 30b381cfdd5e92e5afa6de09f0fe533353e71d07 Mon Sep 17 00:00:00 2001
From: Jiri Denemark <jdenemar@redhat.com>
Date: Mon, 8 Jan 2018 20:53:25 +0100
Subject: [PATCH] cpu: Add SandyBridge-IBRS CPU model

This is a variant of SandyBridge with indirect branch prediction
protection. The only difference between SandyBridge and SandyBridge-IBRS
is the added "spec-ctrl" feature.

The SandyBridge-IBRS model in QEMU is a bit different since SandyBridge
got several additional features since we added it in cpu_map.xml:
    arat, vme, xsaveopt

Adding them only to the -IBRS variant would confuse our CPU detection
code.

Signed-off-by: Jiri Denemark <jdenemar@redhat.com>
Reviewed-by: Pavel Hrdina <phrdina@redhat.com>
---
 src/cpu/cpu_map.xml | 44 ++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 44 insertions(+)

Index: libvirt-1.2.2/src/cpu/cpu_map.xml
===================================================================
--- libvirt-1.2.2.orig/src/cpu/cpu_map.xml	2018-01-25 14:12:52.758444079 -0500
+++ libvirt-1.2.2/src/cpu/cpu_map.xml	2018-01-25 14:12:52.754444074 -0500
@@ -513,6 +513,11 @@
       <feature name='rdtscp'/>
     </model>
 
+    <model name='SandyBridge-IBRS'>
+      <model name='SandyBridge'/>
+      <feature name='spec-ctrl'/>
+    </model>
+
     <model name='Haswell'>
       <model name='SandyBridge'/>
       <feature name='fma'/>
