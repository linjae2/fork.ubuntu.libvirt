From: Guido Guenther <agx@sigxcpu.org>
Date: Thu, 26 Jun 2008 20:01:38 +0200
Subject: Allow libvirt group to access the socket
Forwarded: no
Updated: 2020-08-05

This is the group based access to libvirt functions as it was used
in Ubuntu for quite long.

Debian uses root + policykit for the same. But since Ubuntu did it
the group based way for so long people are used to that, so we keep it.

There are some related tests (if augeas is enabled as build depend) that need
to be adapted in their expected output, that is done in:
 d/p/ubuntu/daemon-augeas-fix-expected.patch


--- a/src/remote/libvirtd.conf.in
+++ b/src/remote/libvirtd.conf.in
@@ -149,7 +149,7 @@
 #
 # To restrict monitoring of domains you may wish to enable
 # an authentication mechanism here
-#auth_unix_ro = "none"
+auth_unix_ro = "none"
 
 # Set an authentication scheme for UNIX read-write sockets
 # By default socket permissions only allow root. If PolicyKit
@@ -159,6 +159,7 @@
 # If the unix_sock_rw_perms are changed you may wish to enable
 # an authentication mechanism here
 #auth_unix_rw = "none"
+auth_unix_rw = "none"
 @CUT_ENABLE_IP@
 
 # Change the authentication scheme for TCP sockets.
--- a/src/remote/libvirtd.socket.in
+++ b/src/remote/libvirtd.socket.in
@@ -8,7 +8,9 @@ Before=@service@.service
 # when using systemd version < 227
 ListenStream=@runstatedir@/libvirt/@sockprefix@-sock
 Service=@service@.service
-SocketMode=0666
+SocketMode=0660
+SocketUser=root
+SocketGroup=libvirt
 
 [Install]
 WantedBy=sockets.target
