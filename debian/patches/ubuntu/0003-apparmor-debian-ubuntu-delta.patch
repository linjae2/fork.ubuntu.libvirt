Subject: [PATCH 0003/0004] More specific rules for Debian/Ubuntu

Index: libvirt/examples/apparmor/libvirt-qemu.in
===================================================================
--- libvirt.orig/examples/apparmor/libvirt-qemu.in	2016-08-08 14:12:26.250334427 +0200
+++ libvirt/examples/apparmor/libvirt-qemu.in	2016-08-08 14:12:26.246334427 +0200
@@ -75,7 +75,6 @@
   # access to firmware's etc
   /usr/share/kvm/** r,
   /usr/share/qemu/** r,
-  /usr/share/qemu-kvm/** r,
   /usr/share/bochs/** r,
   /usr/share/openbios/** r,
   /usr/share/openhackware/** r,
@@ -84,9 +83,6 @@
   /usr/share/seabios/** r,
   /usr/share/misc/sgabios.bin r,
   /usr/share/ovmf/** r,
-  /usr/share/OVMF/** r,
-  /usr/share/AAVMF/** r,
-  /usr/share/qemu-efi/** r,
   /usr/share/slof/** r,
 
   # access PKI infrastructure
@@ -95,7 +91,6 @@
   # the various binaries
   /usr/bin/kvm rmix,
   /usr/bin/qemu rmix,
-  /usr/bin/qemu-kvm rmix,
   /usr/bin/qemu-system-aarch64 rmix,
   /usr/bin/qemu-system-alpha rmix,
   /usr/bin/qemu-system-arm rmix,
@@ -141,7 +136,6 @@
   /usr/bin/qemu-mipsel rmix,
   /usr/bin/qemu-mipsn32 rmix,
   /usr/bin/qemu-mipsn32el rmix,
-  /usr/bin/qemu-nbd rmix,
   /usr/bin/qemu-or32 rmix,
   /usr/bin/qemu-ppc rmix,
   /usr/bin/qemu-ppc64 rmix,
@@ -158,7 +152,6 @@
   /usr/bin/qemu-x86_64 rmix,
 
   # for save and resume
-  /bin/bash rmix,
   /bin/dash rmix,
   /bin/dd rmix,
   /bin/cat rmix,
@@ -174,8 +167,6 @@
   /etc/ceph/ceph.conf r,
 
   # for qemu-block-extra
-  /usr/{lib,lib64}/qemu/block-curl.so mr,
-  /usr/{lib,lib64}/qemu/block-rbd.so mr,
   /usr/lib/@{multiarch}/qemu/*.so rm,
 
   # for access to hugepages
Index: libvirt/examples/apparmor/usr.lib.libvirt.virt-aa-helper.in
===================================================================
--- libvirt.orig/examples/apparmor/usr.lib.libvirt.virt-aa-helper.in	2016-08-08 14:12:26.250334427 +0200
+++ libvirt/examples/apparmor/usr.lib.libvirt.virt-aa-helper.in	2016-08-08 14:12:26.246334427 +0200
@@ -1,7 +1,7 @@
 # Last Modified: Mon, 23 May 2016 15:00:13 +0200
 #include <tunables/global>
 
-/usr/{lib,lib64}/libvirt/virt-aa-helper {
+/usr/lib/libvirt/virt-aa-helper {
   #include <abstractions/base>
   #include <abstractions/user-tmp>
   # Site-specific additions and overrides. See local/README for details.
@@ -20,8 +20,6 @@
   owner @{PROC}/[0-9]*/status r,
   @{PROC}/filesystems r,
 
-  /etc/libnl-3/classid r,
-
   # for hostdev
   /sys/devices/ r,
   /sys/devices/** r,
@@ -32,7 +30,7 @@
   deny /dev/mapper/ r,
   deny /dev/mapper/* r,
 
-  /usr/{lib,lib64}/libvirt/virt-aa-helper mr,
+  /usr/lib/libvirt/virt-aa-helper mr,
   /sbin/apparmor_parser Ux,
 
   # for openvswitch
Index: libvirt/examples/apparmor/usr.sbin.libvirtd.in
===================================================================
--- libvirt.orig/examples/apparmor/usr.sbin.libvirtd.in	2016-08-08 14:12:26.250334427 +0200
+++ libvirt/examples/apparmor/usr.sbin.libvirtd.in	2016-08-08 14:12:26.246334427 +0200
@@ -15,7 +15,6 @@
   capability sys_admin,
   capability sys_module,
   capability sys_ptrace,
-  capability sys_pacct,
   capability sys_nice,
   capability sys_chroot,
   capability setuid,
@@ -37,7 +36,6 @@
   network inet6 stream,
   network inet6 dgram,
   network packet dgram,
-  network packet raw,
 @@ifge 2009
   network netlink,
 @@end
@@ -62,9 +60,9 @@
   /usr/sbin/virtlogd pix,
   /usr/sbin/* PUx,
   /lib/udev/scsi_id PUx,
-  /usr/{lib,lib64}/xen-common/bin/xen-toolstack PUx,
-  /usr/{lib,lib64}/xen-*/bin/pygrub PUx,
-  /usr/{lib,lib64}/xen-*/bin/libxl-save-helper PUx,
+  /usr/lib/xen-common/bin/xen-toolstack PUx,
+  /usr/lib/xen-*/bin/pygrub PUx,
+  /usr/lib/xen-*/bin/libxl-save-helper PUx,
 
   # Required by nwfilter_ebiptables_driver.c:ebiptablesWriteToTempFile() to
   # write and run an ebtables script.
@@ -77,7 +75,7 @@
   audit deny /sys/kernel/security/apparmor/matching rwxl,
   audit deny /sys/kernel/security/apparmor/.* rwxl,
   /sys/kernel/security/apparmor/profiles r,
-  /usr/{lib,lib64}/libvirt/* PUxr,
+  /usr/lib/libvirt/* PUxr,
   /etc/libvirt/hooks/** rmix,
   /etc/xen/scripts/** rmix,
 
