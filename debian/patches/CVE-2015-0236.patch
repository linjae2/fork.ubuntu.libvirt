Description: fix VNC password leak via snapshots and save images
Origin: upstream, http://libvirt.org/git/?p=libvirt.git;a=commit;h=e99c25ca63c695a63b4c9b91ee956be4fb660772
Origin: upstream, http://libvirt.org/git/?p=libvirt.git;a=commit;h=8107c1e3694ba4685960ec09868076379718f037
Bug-Debian: http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=776065

Index: libvirt-1.2.2/src/qemu/qemu_driver.c
===================================================================
--- libvirt-1.2.2.orig/src/qemu/qemu_driver.c	2016-01-08 10:01:49.859605491 -0500
+++ libvirt-1.2.2/src/qemu/qemu_driver.c	2016-01-08 10:02:34.080092542 -0500
@@ -5552,7 +5552,7 @@
     if (fd < 0)
         goto cleanup;
 
-    if (virDomainSaveImageGetXMLDescEnsureACL(conn, def) < 0)
+    if (virDomainSaveImageGetXMLDescEnsureACL(conn, def, flags) < 0)
         goto cleanup;
 
     ret = qemuDomainDefFormatXML(driver, def, flags);
@@ -13776,7 +13776,7 @@
     if (!(vm = qemuDomObjFromSnapshot(snapshot)))
         goto cleanup;
 
-    if (virDomainSnapshotGetXMLDescEnsureACL(snapshot->domain->conn, vm->def) < 0)
+    if (virDomainSnapshotGetXMLDescEnsureACL(snapshot->domain->conn, vm->def, flags) < 0)
         goto cleanup;
 
     if (!(snap = qemuSnapObjFromSnapshot(vm, snapshot)))
Index: libvirt-1.2.2/src/remote/remote_protocol.x
===================================================================
--- libvirt-1.2.2.orig/src/remote/remote_protocol.x	2016-01-08 09:40:22.000000000 -0500
+++ libvirt-1.2.2/src/remote/remote_protocol.x	2016-01-08 10:02:34.080092542 -0500
@@ -4291,6 +4291,7 @@
      * @generate: both
      * @priority: high
      * @acl: domain:read
+     * @acl: domain:read_secure:VIR_DOMAIN_XML_SECURE
      */
     REMOTE_PROC_DOMAIN_SNAPSHOT_GET_XML_DESC = 186,
 
@@ -4621,6 +4622,7 @@
      * @generate: both
      * @priority: high
      * @acl: domain:read
+     * @acl: domain:read_secure:VIR_DOMAIN_XML_SECURE
      */
     REMOTE_PROC_DOMAIN_SAVE_IMAGE_GET_XML_DESC = 235,
 
