From ae076bb40e0e150aef41361b64001138d04d6c60 Mon Sep 17 00:00:00 2001
From: =?utf8?q?Daniel=20P.=20Berrang=C3=A9?= <berrange@redhat.com>
Date: Wed, 27 Mar 2019 11:22:49 +0000
Subject: [PATCH] remote: enforce ACL write permission for getting guest time & hostname
MIME-Version: 1.0
Content-Type: text/plain; charset=utf8
Content-Transfer-Encoding: 8bit

Getting the guest time and hostname both require use of guest agent
commands. These must not be allowed for read-only users, so the
permissions check must validate "write" permission not "read".

Fixes CVE-2019-3886
Reviewed-by: Jim Fehlig <jfehlig@suse.com>
Signed-off-by: Daniel P. BerrangÃ© <berrange@redhat.com>
---
 src/remote/remote_protocol.x |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

Index: libvirt-5.0.0/src/remote/remote_protocol.x
===================================================================
--- libvirt-5.0.0.orig/src/remote/remote_protocol.x	2019-06-17 07:18:04.198914812 -0400
+++ libvirt-5.0.0/src/remote/remote_protocol.x	2019-06-17 07:18:04.194914786 -0400
@@ -5505,7 +5505,7 @@ enum remote_procedure {
 
     /**
      * @generate: both
-     * @acl: domain:read
+     * @acl: domain:write
      */
     REMOTE_PROC_DOMAIN_GET_HOSTNAME = 277,
 
@@ -5900,7 +5900,7 @@ enum remote_procedure {
 
     /**
      * @generate: none
-     * @acl: domain:read
+     * @acl: domain:write
      */
     REMOTE_PROC_DOMAIN_GET_TIME = 337,
 
