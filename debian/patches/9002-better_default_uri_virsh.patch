Index: libvirt-0.7.0/src/virsh.c
===================================================================
--- libvirt-0.7.0.orig/src/virsh.c	2009-07-24 11:38:23.000000000 -0500
+++ libvirt-0.7.0/src/virsh.c	2009-08-13 20:36:29.000000000 -0500
@@ -57,6 +57,8 @@
 #define VSH_PROMPT_RW    "virsh # "
 #define VSH_PROMPT_RO    "virsh > "
 
+#include "remote_internal.h"
+
 #define GETTIMEOFDAY(T) gettimeofday(T, NULL)
 #define DIFF_MSEC(T, U) \
         ((((int) ((T)->tv_sec - (U)->tv_sec)) * 1000000.0 + \
@@ -8434,6 +8436,10 @@
 
     if ((defaultConn = getenv("VIRSH_DEFAULT_CONNECT_URI"))) {
         ctl->name = strdup(defaultConn);
+    } else if (!access(LIBVIRTD_PRIV_UNIX_SOCKET, W_OK)) {
+        ctl->name = strdup("qemu:///system");
+    } else {
+        ctl->name = strdup("qemu:///session");
     }
 
     if (!vshParseArgv(ctl, argc, argv)) {
@@ -8441,6 +8447,9 @@
         exit(EXIT_FAILURE);
     }
 
+    if (!ctl->quiet)
+        fprintf(stderr, _("Connecting to uri: %s\n"), ctl->name);
+
     if (!vshInit(ctl)) {
         vshDeinit(ctl);
         exit(EXIT_FAILURE);
