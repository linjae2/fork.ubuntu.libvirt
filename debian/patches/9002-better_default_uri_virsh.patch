diff -Nur libvirt-0.7.5/tools/Makefile.am libvirt-0.7.5.new/tools/Makefile.am
--- libvirt-0.7.5/tools/Makefile.am	2009-12-22 03:37:57.000000000 -0600
+++ libvirt-0.7.5.new/tools/Makefile.am	2010-01-22 14:44:25.889976145 -0600
@@ -45,9 +45,11 @@
 		-I$(top_srcdir)/gnulib/lib -I../gnulib/lib	\
 		-I../include -I$(top_srcdir)/include		\
 		-I$(top_srcdir)/src				\
+		-I$(top_srcdir)/src/remote			\
 		-I$(top_srcdir)/src/util			\
 		-DGETTEXT_PACKAGE=\"$(PACKAGE)\"		\
 		-DLOCALEBASEDIR=\""$(datadir)/locale"\"		\
+		-DLOCAL_STATE_DIR=\""$(localstatedir)"\"	\
 		$(COVERAGE_CFLAGS)				\
 		$(LIBXML_CFLAGS)				\
 		$(READLINE_CFLAGS)
diff -Nur libvirt-0.7.5/tools/Makefile.in libvirt-0.7.5.new/tools/Makefile.in
--- libvirt-0.7.5/tools/Makefile.in	2009-12-23 09:17:44.000000000 -0600
+++ libvirt-0.7.5.new/tools/Makefile.in	2010-01-22 14:44:25.900780145 -0600
@@ -969,9 +969,11 @@
 		-I$(top_srcdir)/gnulib/lib -I../gnulib/lib	\
 		-I../include -I$(top_srcdir)/include		\
 		-I$(top_srcdir)/src				\
+		-I$(top_srcdir)/src/remote			\
 		-I$(top_srcdir)/src/util			\
 		-DGETTEXT_PACKAGE=\"$(PACKAGE)\"		\
 		-DLOCALEBASEDIR=\""$(datadir)/locale"\"		\
+		-DLOCAL_STATE_DIR=\""$(localstatedir)"\"	\
 		$(COVERAGE_CFLAGS)				\
 		$(LIBXML_CFLAGS)				\
 		$(READLINE_CFLAGS)
diff -Nur libvirt-0.7.5/tools/virsh.c libvirt-0.7.5.new/tools/virsh.c
--- libvirt-0.7.5/tools/virsh.c	2009-12-22 03:37:57.000000000 -0600
+++ libvirt-0.7.5.new/tools/virsh.c	2010-01-22 14:44:25.889976145 -0600
@@ -58,6 +58,8 @@
 #define VSH_PROMPT_RW    "virsh # "
 #define VSH_PROMPT_RO    "virsh > "
 
+#include "remote_driver.h"
+
 #define GETTIMEOFDAY(T) gettimeofday(T, NULL)
 #define DIFF_MSEC(T, U) \
         ((((int) ((T)->tv_sec - (U)->tv_sec)) * 1000000.0 + \
@@ -8945,6 +8947,10 @@
 
     if ((defaultConn = getenv("VIRSH_DEFAULT_CONNECT_URI"))) {
         ctl->name = strdup(defaultConn);
+    } else if (!access(LIBVIRTD_PRIV_UNIX_SOCKET, W_OK)) {
+        ctl->name = strdup("qemu:///system");
+    } else {
+        ctl->name = strdup("qemu:///session");
     }
 
     if (!vshParseArgv(ctl, argc, argv)) {
