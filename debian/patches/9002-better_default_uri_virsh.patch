diff -Naurp libvirt-0.9.12.orig/tools/Makefile.am libvirt-0.9.12/tools/Makefile.am
--- libvirt-0.9.12.orig/tools/Makefile.am	2012-02-05 21:50:50.000000000 -0500
+++ libvirt-0.9.12/tools/Makefile.am	2012-05-14 11:00:41.415698873 -0400
@@ -5,8 +5,10 @@ INCLUDES = \
 	-I$(top_builddir)/include -I$(top_srcdir)/include	\
 	-I$(top_builddir)/gnulib/lib -I$(top_srcdir)/gnulib/lib	\
 	-I$(top_builddir)/src -I$(top_srcdir)/src		\
+	-I$(top_srcdir)/src/remote              \
 	-I$(top_srcdir)/src/util				\
 	-I$(top_srcdir)						\
+    -DLOCAL_STATE_DIR=\""$(localstatedir)"\"        \
 	$(GETTEXT_CPPFLAGS)
 
 POD2MAN = pod2man -c "Virtualization Support" -r "$(PACKAGE)-$(VERSION)"
diff -Naurp libvirt-0.9.12.orig/tools/Makefile.in libvirt-0.9.12/tools/Makefile.in
--- libvirt-0.9.12.orig/tools/Makefile.in	2012-05-13 22:55:28.000000000 -0400
+++ libvirt-0.9.12/tools/Makefile.in	2012-05-14 11:01:39.039700253 -0400
@@ -1504,8 +1504,10 @@ INCLUDES = \
 	-I$(top_builddir)/include -I$(top_srcdir)/include	\
 	-I$(top_builddir)/gnulib/lib -I$(top_srcdir)/gnulib/lib	\
 	-I$(top_builddir)/src -I$(top_srcdir)/src		\
+	-I$(top_srcdir)/src/remote              \
 	-I$(top_srcdir)/src/util				\
 	-I$(top_srcdir)						\
+    -DLOCAL_STATE_DIR=\""$(localstatedir)"\"        \
 	$(GETTEXT_CPPFLAGS)
 
 POD2MAN = pod2man -c "Virtualization Support" -r "$(PACKAGE)-$(VERSION)"
diff -Naurp libvirt-0.9.12.orig/tools/virsh.c libvirt-0.9.12/tools/virsh.c
--- libvirt-0.9.12.orig/tools/virsh.c	2012-05-08 21:21:54.000000000 -0400
+++ libvirt-0.9.12/tools/virsh.c	2012-05-14 11:03:41.807703076 -0400
@@ -64,6 +64,8 @@
 #include "conf/domain_conf.h"
 #include "virtypedparam.h"
 
+#include "remote_driver.h"
+
 static char *progname;
 
 #define VIRSH_MAX_XML_FILE 10*1024*1024
@@ -20309,6 +20311,10 @@ main(int argc, char **argv)
 
     if ((defaultConn = getenv("VIRSH_DEFAULT_CONNECT_URI"))) {
         ctl->name = vshStrdup(ctl, defaultConn);
+    } else if (!access(LIBVIRTD_PRIV_UNIX_SOCKET, W_OK)) {
+        ctl->name = vshStrdup(ctl, "qemu:///system");
+    } else {
+        ctl->name = vshStrdup(ctl, "qemu:///session");
     }
 
     if (!vshParseArgv(ctl, argc, argv)) {
