#!/usr/bin/make -f

DEB_PYTHON_SYSTEM=pycentral
DEB_DH_INSTALL_SOURCEDIR = debian/tmp

include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/class/autotools.mk
include /usr/share/cdbs/1/class/python-distutils.mk
include /usr/share/cdbs/1/rules/patchsys-quilt.mk

DEB_DH_INSTALL_ARGS := --list-missing

DEB_CONFIGURE_EXTRA_FLAGS := --disable-rpath --with-qemu --without-openvz --with-avahi
DEB_PYTHON_SETUP_CMD := /dev/null

EXAMPLES=debian/libvirt-doc/usr/share/doc/libvirt-doc/examples/

binary-install/libvirt-doc::
	cd $(EXAMPLES) && rm -rf .libs *.o info1 suspend

build/libvirt-bin::
	mkdir -p debian/tmp/etc/libvirt
#	install -m 750 debian/libvirtd.conf debian/tmp/etc/libvirt
#	install -m 750 debian/qemud.conf debian/tmp/etc/libvirt

# Don't shove the libraries in -dbg into /var/lib/debug
DEB_DBG_PACKAGES = 

install/libvirt0-dbg::
	$(DEB_MAKE_INVOKE) clean
	$(DEB_CONFIGURE_INVOKE) $(cdbs_configure_flags) $(DEB_CONFIGURE_EXTRA_FLAGS) $(DEB_CONFIGURE_USER_FLAGS) --enable-debug=yes
	$(DEB_MAKE_INVOKE)  install DESTDIR=$(CURDIR)/debian/tmp-dbg/

binary-install/libvirt0-dbg::
	dh_install -p$(cdbs_curpkg) --sourcedir=debian/tmp-dbg $(DEB_DH_INSTALL_ARGS)

clean::
	rm -rf debian/tmp-dbg
